"""
LLM 파서용 프롬프트 정의

이 파일에는 두 개의 분리된 프롬프트가 정의되어 있습니다:
1. EXTRACTION_PROMPT: 자유수영(일일발권) 스케줄 정보 추출 전용
2. CLOSURE_EXTRACTION_PROMPT: 시설 휴무일 정보 추출 전용

각 프롬프트는 단일 책임을 가지며, 서로의 영역을 침범하지 않습니다.
"""

CLOSURE_EXTRACTION_PROMPT = """당신은 수영장 공지사항에서 휴무일 정보만을 추출하는 전문가입니다.

아래 텍스트에서 시설의 휴무일/휴관일 정보만 추출하여 JSON 형식으로 반환해주세요.

**중요: 이 프롬프트의 책임은 오직 휴무일 정보 추출입니다.**
- 자유수영, 강습, 요금, 시간표 등 운영 정보는 모두 무시하세요.
- 오직 "휴무", "휴관", "휴장", "운영 중단" 관련 정보만 추출합니다.

추출할 정보:
1. facility_name: 시설명 (수영장 이름)
2. closures: 휴무일 정보 배열

closures 배열의 각 요소는 다음 세 가지 타입 중 하나입니다:

1. regular (정기휴무):
   - closure_type: "regular"
   - day_of_week: 휴무 요일 (월요일, 화요일, 수요일, 목요일, 금요일, 토요일, 일요일)
   - week_pattern: 주차 패턴 ("2,4" = 매월 2,4주차, null = 매주)
   - reason: 휴무 사유

2. holiday (공휴일 휴무):
   - closure_type: "holiday"
   - reason: "공휴일 휴관" 등의 사유
   - (dates 필드 없음 - 공휴일 날짜 계산은 코드에서 처리)

3. specific_date (특정 날짜 휴무):
   - closure_type: "specific_date"
   - dates: YYYY-MM-DD 형식의 날짜 배열
   - reason: 휴무 사유

휴무일 해석 규칙:
- "매주 X요일 휴장/휴관" → regular, week_pattern은 null
- "매월 N주 X요일 휴관" → regular, week_pattern에 해당 주차 (예: "2,4")
- "격주 X요일 휴관" → regular, week_pattern은 "1,3" 또는 "2,4"로 해석
- "공휴일 휴관" → holiday
- "N월 N일 휴관" → specific_date, dates에 YYYY-MM-DD 형식으로
- "N월 N일~N일 휴관" → specific_date, 해당 기간의 모든 날짜를 dates 배열에 포함
- 휴무일 정보가 전혀 없으면 closures는 빈 배열 []로 반환

**절대 금지 사항:**
- 문서에 명시되지 않은 휴무일을 추론하거나 생성하지 마세요.
- 현재 날짜를 기준으로 임의의 휴무일을 만들지 마세요.
- 운영 시간, 요금, 자유수영 정보는 추출하지 마세요.

응답 형식 (JSON만 반환, 다른 텍스트 없이):
{
  "facility_name": "시설명",
  "closures": [
    {"closure_type": "regular", "day_of_week": "월요일", "week_pattern": null, "reason": "정기휴무"},
    {"closure_type": "regular", "day_of_week": "일요일", "week_pattern": "2,4", "reason": "정기휴장"},
    {"closure_type": "holiday", "reason": "공휴일 휴관"},
    {"closure_type": "specific_date", "dates": ["2026-02-16", "2026-02-17", "2026-02-18"], "reason": "설날 연휴"}
  ]
}

휴무일 정보가 없는 경우:
{
  "facility_name": "시설명",
  "closures": []
}

텍스트:
"""

EXTRACTION_PROMPT = """당신은 수영장 자유수영 안내문에서 정보를 추출하는 전문가입니다.

아래 텍스트에서 **일일자유수영(일일발권)** 관련 정보만 추출하여 JSON 형식으로 반환해주세요.

**★★★ 가장 중요한 규칙: "일일자유이용"과 "월자유"를 반드시 구분하세요! ★★★**

문서에는 보통 다음과 같은 여러 프로그램이 있습니다:
1. **수영강습** - 초급/중급/상급/연수 등 강습 프로그램 (제외)
2. **수영 월자유** - 월 정기권 회원용 자유수영 (제외)
3. **일일자유이용** - 일일 발권 자유수영 (**이것만 추출**)

**추출해야 할 것 (일일자유이용):**
- "일일자유이용", "일일발권", "일일자유수영" 섹션/테이블의 정보
- 이용료가 수천원 단위 (예: 3,000원, 3,600원, 2,400원)
- 평일에 1~2개 시간대만 운영 (예: 16:00~17:50)
- 토/일에 2~4개 시간대 운영 (예: 10:00~11:50, 13:00~14:50, 16:00~17:50)

**제외해야 할 것:**
- "수영강습", "강습반", "초급", "중급", "상급", "연수" 관련 정보
- "수영 월자유", "월자유", "월정기", "월회원" 섹션의 정보
- 이용료가 수만원 단위 (예: 45,000원, 54,000원) → 이것은 월정기권입니다!
- 시간대가 06:00~20:50까지 여러 개 있고 각 시간별 40명인 경우 → 이것은 월자유입니다!

**구분 방법:**
- 월자유: 이용료 수만원, 시간대 많음 (06:00, 07:00, 09:00, 10:00, 11:00, 19:00, 20:00 등)
- 일일자유: 이용료 수천원, 시간대 적음 (평일 1개, 주말 2~3개)

**중요: 이 프롬프트의 책임은 오직 "일일자유이용" 스케줄 정보 추출입니다.**
- 휴무일, 휴관일, 공휴일 휴무 정보는 이 프롬프트의 책임이 아닙니다.
- 문서에 휴무 관련 문구가 있더라도 완전히 무시하세요.
- "매주 X요일 휴관", "공휴일 휴무", "N월 N일 휴장" 등의 정보는 추출하지 마세요.

추출할 정보:
1. facility_name: 시설명 (수영장 이름)
2. valid_month: 프로그램이 적용되는 월 (YYYY년 M월 형식으로 반환)
   - **연도 추출 우선순위 (중요!):**
     1순위: 공지사항 제목(notice_title)에 명시된 연도와 월
       * 제목: "2026년 1월 수영 프로그램 운영 안내" → "2026년 1월"
       * 제목: "2025년 12월 수영장 이용 안내" → "2025년 12월"
       * **제목에 명시된 연도와 월을 절대 우선으로 사용할 것**
     2순위: 문서 첫 줄에 있는 "YYYY년 X월 수영 프로그램" 형태
     3순위: 문서 내용에서 찾은 년도 + 첫 줄의 월 조합
       * 예: 첫 줄 "2월 수영 프로그램" + 문서 내 "2026년" → "2026년 2월"
     4순위: 공지 등록일(notice_date)을 참고하여 추론 (제목/문서에 연도 없을 때)
       * **연도 추론 규칙:**
         - 등록일의 월 >= 프로그램 월: 같은 연도 사용
           예) 등록일 2025-10-20, 프로그램 "11월" → 2025년 11월
         - 등록일의 월 < 프로그램 월이고, 프로그램 월이 1~3월인 경우: 다음 연도 사용
           예) 등록일 2025-12-29, 프로그램 "1월" → 2026년 1월
           예) 등록일 2025-11-15, 프로그램 "2월" → 2026년 2월
         - 특히, 등록일이 10~12월이고 프로그램이 1~3월이면 반드시 다음 연도를 사용
   - **주의사항:**
     * 절대로 현재 날짜를 기준으로 연도를 추론하지 말 것
     * 등록일보다 1년 이상 미래의 연도를 생성하지 말 것
     * 문서 첫 줄의 월을 사용하고, 다른 월로 변경하지 말 것
3. schedules: 요일별 자유수영 스케줄
   - day_type: "평일", "토요일", "일요일" 중 하나
   - season: 계절 구분 ("하절기", "동절기", 또는 계절 구분이 없으면 빈 문자열 "")
   - season_months: 적용 월 (예: "3~10월", "11~2월", 또는 계절 구분이 없으면 빈 문자열 "")
   - sessions: 각 세션 정보 배열
     - session_name: 세션명 (아침, 점심, 저녁, 1부, 2부 등)
     - start_time: 시작 시간 (HH:MM 형식)
     - end_time: 종료 시간 (HH:MM 형식)
     - capacity: 정원 (숫자, 없으면 null)
     - lanes: 레인 수 (숫자, 없으면 null)
     - applicable_days: 적용 요일 (특정 요일에만 적용되면 "월", "수", "월,수,금" 등, 해당 day_type 전체에 적용되면 null)
4. fees: **일일자유이용** 이용료 정보 배열 (월정기권 요금은 제외!)
   - category: 대상 (성인, 청소년, 어린이 등)
   - price: 금액 (숫자만, 원 단위) - 수천원 단위여야 함 (예: 3600, 3000, 2400)
   - note: 비고 (조건 등)
   - **주의: 수만원 단위 요금(45000원, 54000원 등)은 월정기권이므로 제외하세요!**
5. notes: 기타 중요 안내사항 (배열)

중요: 토요일/일요일에 하절기(3~10월)와 동절기(11~2월) 운영시간이 다르면 각각 별도의 스케줄로 분리해서 추출하세요.

중요 규칙 (반드시 준수):
1. **평일/주말 구분이 최우선입니다**
   - 문서에서 "평일", "토요일", "일요일" 또는 "주말" 키워드를 찾으세요
   - 해당 키워드 바로 아래/옆에 나열된 시간대를 해당 요일에 할당하세요
   - 키워드와 멀리 떨어진 시간대는 해당 요일이 아닐 가능성이 높습니다

2. **일반적인 패턴 인식**:
   - 주말은 평일보다 운영 시간대가 적은 경우가 많음
   - 새벽 시간대(6시 이전)는 주로 평일에만 운영
   - 늦은 저녁 시간대(19시 이후)도 평일에 더 많이 운영
   - 정원(capacity)은 일반적으로 주말이 평일보다 많음

3. **표 형식 문서 해석**:
   - 요일이 열(column) 헤더인 경우: 각 열의 데이터는 해당 요일에 속함
   - 요일이 행(row) 헤더인 경우: 각 행의 데이터는 해당 요일에 속함
   - 표가 깨진 경우: "평일", "토요일", "일요일" 텍스트와 가장 가까운 시간대를 해당 요일로 간주

4. **용량(capacity)으로 요일 구분**:
   - 같은 시간대가 다른 용량으로 반복되면 다른 요일입니다
   - 일반적으로 주말 용량 > 평일 용량 (예: 평일 60명, 주말 100명)
   - 용량이 200명처럼 매우 크면 주말일 가능성 높음

5. **검증 체크리스트**:
   - [ ] "일일자유이용" 섹션에서 추출했는가? ("월자유" 섹션이 아닌지 확인!)
   - [ ] 평일 시간대가 1~2개인가? (6~8개면 월자유를 잘못 추출한 것!)
   - [ ] 이용료가 수천원 단위인가? (수만원이면 월정기권을 잘못 추출한 것!)
   - [ ] 평일 시간대가 주말에 들어가지 않았는가?
   - [ ] 주말 시간대가 평일에 들어가지 않았는가?

6. **특정 요일만 적용되는 세션 처리 (매우 중요!)**:
   - "수요일", "월요일", "금요일" 등 특정 요일명이 세션 앞에 붙어있으면 해당 요일에만 적용
   - 예: "수요일 06:00~06:50 50명" → day_type은 "평일", applicable_days는 "수"
   - 예: "월,수,금 10:00~11:00 30명" → day_type은 "평일", applicable_days는 "월,수,금"
   - "상동"이라고 표시된 경우 시간은 동일하고 정원만 다른 것이므로, 앞의 시간대를 참조
   - 특정 요일 언급 없이 "평일"로만 표기된 세션은 applicable_days를 null로 설정

예시 케이스 1 (월자유 vs 일일자유 구분):
문서에 다음 두 테이블이 있다면:
- "수영 월자유": 06:00~20:50 여러 시간대, 시간별 40명, 이용료 54,000원 → **제외!**
- "일일자유이용": 평일 16:00~17:50 80명, 토·일 10:00~17:50 시간별 100명, 이용료 3,600원 → **추출!**

예시 케이스 2 (일반적인 일일자유이용):
문서에 "평일: 16:00~17:50 80명, 토요일/일요일: 10:00~11:50 100명, 13:00~14:50 100명, 16:00~17:50 100명"이 있다면
→ 평일에는 16:00~17:50(80명)만, 토/일에는 3개 시간대(각 100명)를 할당

응답 형식 (JSON만 반환, 다른 텍스트 없이):
{
  "facility_name": "시설명",
  "valid_month": "2026년 2월",
  "schedules": [
    {
      "day_type": "평일",
      "season": "",
      "season_months": "",
      "sessions": [
        {"session_name": "1부", "start_time": "16:00", "end_time": "17:50", "capacity": 80, "lanes": null, "applicable_days": null}
      ]
    },
    {
      "day_type": "토요일",
      "season": "",
      "season_months": "",
      "sessions": [
        {"session_name": "1부", "start_time": "10:00", "end_time": "11:50", "capacity": 100, "lanes": null, "applicable_days": null},
        {"session_name": "2부", "start_time": "13:00", "end_time": "14:50", "capacity": 100, "lanes": null, "applicable_days": null},
        {"session_name": "3부", "start_time": "16:00", "end_time": "17:50", "capacity": 100, "lanes": null, "applicable_days": null}
      ]
    },
    {
      "day_type": "일요일",
      "season": "",
      "season_months": "",
      "sessions": [
        {"session_name": "1부", "start_time": "10:00", "end_time": "11:50", "capacity": 100, "lanes": null, "applicable_days": null},
        {"session_name": "2부", "start_time": "13:00", "end_time": "14:50", "capacity": 100, "lanes": null, "applicable_days": null},
        {"session_name": "3부", "start_time": "16:00", "end_time": "17:50", "capacity": 100, "lanes": null, "applicable_days": null}
      ]
    }
  ],
  "fees": [
    {"category": "일반", "price": 3600, "note": ""},
    {"category": "청소년", "price": 3000, "note": ""},
    {"category": "어린이", "price": 2400, "note": "36개월 이상"}
  ],
  "notes": ["모든 수영 보조기구 사용 불가"]
}

**주의: closures 필드는 이 프롬프트의 출력에 포함하지 마세요. 휴무일 정보는 별도의 휴무일 전용 프롬프트에서 처리됩니다.**

텍스트:
"""
