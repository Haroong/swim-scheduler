"""
LLM 파서용 프롬프트 정의
"""

EXTRACTION_PROMPT = """당신은 수영장 자유수영 안내문에서 정보를 추출하는 전문가입니다.

아래 텍스트에서 자유수영 관련 정보만 추출하여 JSON 형식으로 반환해주세요.
강습 프로그램 정보는 제외하고, 오직 자유수영(일일발권) 정보만 추출합니다.

추출할 정보:
1. facility_name: 시설명 (수영장 이름)
2. valid_month: 프로그램이 적용되는 월 (YYYY년 M월 형식으로 반환)
   - **연도 추출 우선순위 (중요!):**
     1순위: 공지사항 제목(notice_title)에 명시된 연도와 월
       * 제목: "2026년 1월 수영 프로그램 운영 안내" → "2026년 1월"
       * 제목: "2025년 12월 수영장 이용 안내" → "2025년 12월"
       * **제목에 명시된 연도와 월을 절대 우선으로 사용할 것**
     2순위: 문서 첫 줄에 있는 "YYYY년 X월 수영 프로그램" 형태
     3순위: 문서 내용에서 찾은 년도 + 첫 줄의 월 조합
       * 예: 첫 줄 "2월 수영 프로그램" + 문서 내 "2026년" → "2026년 2월"
     4순위: 공지 등록일(notice_date)을 참고하여 추론 (제목/문서에 연도 없을 때)
       * **연도 추론 규칙:**
         - 등록일의 월 >= 프로그램 월: 같은 연도 사용
           예) 등록일 2025-10-20, 프로그램 "11월" → 2025년 11월
         - 등록일의 월 < 프로그램 월이고, 프로그램 월이 1~3월인 경우: 다음 연도 사용
           예) 등록일 2025-12-29, 프로그램 "1월" → 2026년 1월
           예) 등록일 2025-11-15, 프로그램 "2월" → 2026년 2월
         - 특히, 등록일이 10~12월이고 프로그램이 1~3월이면 반드시 다음 연도를 사용
   - **주의사항:**
     * 절대로 현재 날짜를 기준으로 연도를 추론하지 말 것
     * 등록일보다 1년 이상 미래의 연도를 생성하지 말 것
     * 문서 첫 줄의 월을 사용하고, 다른 월로 변경하지 말 것
3. schedules: 요일별 자유수영 스케줄
   - day_type: "평일", "토요일", "일요일" 중 하나
   - season: 계절 구분 ("하절기", "동절기", 또는 계절 구분이 없으면 빈 문자열 "")
   - season_months: 적용 월 (예: "3~10월", "11~2월", 또는 계절 구분이 없으면 빈 문자열 "")
   - sessions: 각 세션 정보 배열
     - session_name: 세션명 (아침, 점심, 저녁, 1부, 2부 등)
     - start_time: 시작 시간 (HH:MM 형식)
     - end_time: 종료 시간 (HH:MM 형식)
     - capacity: 정원 (숫자, 없으면 null)
     - lanes: 레인 수 (숫자, 없으면 null)
     - applicable_days: 적용 요일 (특정 요일에만 적용되면 "월", "수", "월,수,금" 등, 해당 day_type 전체에 적용되면 null)
4. fees: 이용료 정보 배열
   - category: 대상 (성인, 청소년, 어린이 등)
   - price: 금액 (숫자만, 원 단위)
   - note: 비고 (조건 등)
5. notes: 기타 중요 안내사항 (배열)

중요: 토요일/일요일에 하절기(3~10월)와 동절기(11~2월) 운영시간이 다르면 각각 별도의 스케줄로 분리해서 추출하세요.

중요 규칙 (반드시 준수):
1. **평일/주말 구분이 최우선입니다**
   - 문서에서 "평일", "토요일", "일요일" 또는 "주말" 키워드를 찾으세요
   - 해당 키워드 바로 아래/옆에 나열된 시간대를 해당 요일에 할당하세요
   - 키워드와 멀리 떨어진 시간대는 해당 요일이 아닐 가능성이 높습니다

2. **일반적인 패턴 인식**:
   - 주말은 평일보다 운영 시간대가 적은 경우가 많음
   - 새벽 시간대(6시 이전)는 주로 평일에만 운영
   - 늦은 저녁 시간대(19시 이후)도 평일에 더 많이 운영
   - 정원(capacity)은 일반적으로 주말이 평일보다 많음

3. **표 형식 문서 해석**:
   - 요일이 열(column) 헤더인 경우: 각 열의 데이터는 해당 요일에 속함
   - 요일이 행(row) 헤더인 경우: 각 행의 데이터는 해당 요일에 속함
   - 표가 깨진 경우: "평일", "토요일", "일요일" 텍스트와 가장 가까운 시간대를 해당 요일로 간주

4. **용량(capacity)으로 요일 구분**:
   - 같은 시간대가 다른 용량으로 반복되면 다른 요일입니다
   - 일반적으로 주말 용량 > 평일 용량 (예: 평일 60명, 주말 100명)
   - 용량이 200명처럼 매우 크면 주말일 가능성 높음

5. **검증 체크리스트**:
   - [ ] 평일 시간대가 주말에 들어가지 않았는가?
   - [ ] 주말 시간대가 평일에 들어가지 않았는가?
   - [ ] 각 요일의 시간대 개수가 합리적인가? (주말은 보통 3-4개, 평일은 4-5개)
   - [ ] 새벽 6시 시간대는 평일에만 있는가?

6. **특정 요일만 적용되는 세션 처리 (매우 중요!)**:
   - "수요일", "월요일", "금요일" 등 특정 요일명이 세션 앞에 붙어있으면 해당 요일에만 적용
   - 예: "수요일 06:00~06:50 50명" → day_type은 "평일", applicable_days는 "수"
   - 예: "월,수,금 10:00~11:00 30명" → day_type은 "평일", applicable_days는 "월,수,금"
   - "상동"이라고 표시된 경우 시간은 동일하고 정원만 다른 것이므로, 앞의 시간대를 참조
   - 특정 요일 언급 없이 "평일"로만 표기된 세션은 applicable_days를 null로 설정

예시 케이스:
문서에 "평일: 16:00~17:50 80명, 토요일/일요일: 10:00~11:50 100명, 13:00~14:50 100명, 16:00~17:50 100명"이 있다면
→ 평일에는 16:00~17:50(80명)만, 토/일에는 3개 시간대(각 100명)를 할당

응답 형식 (JSON만 반환, 다른 텍스트 없이):
{
  "facility_name": "시설명",
  "valid_month": "2026년 2월",
  "schedules": [
    {
      "day_type": "평일",
      "season": "",
      "season_months": "",
      "sessions": [
        {"session_name": "1부", "start_time": "06:00", "end_time": "06:50", "capacity": 24, "lanes": null, "applicable_days": null},
        {"session_name": "수요일", "start_time": "06:00", "end_time": "06:50", "capacity": 50, "lanes": null, "applicable_days": "수"}
      ]
    },
    {
      "day_type": "토요일",
      "season": "동절기",
      "season_months": "11~2월",
      "sessions": [
        {"session_name": "1부", "start_time": "06:30", "end_time": "08:00", "capacity": 80, "lanes": 6, "applicable_days": null}
      ]
    },
    {
      "day_type": "토요일",
      "season": "하절기",
      "season_months": "3~10월",
      "sessions": [
        {"session_name": "1부", "start_time": "06:30", "end_time": "08:00", "capacity": 80, "lanes": 6, "applicable_days": null}
      ]
    }
  ],
  "fees": [
    {"category": "성인", "price": 3000, "note": ""}
  ],
  "notes": ["48개월 미만 영아 출입 불가"]
}

텍스트:
"""
